<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase Compat -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>

<body class="bg-slate-100 min-h-screen p-4">

  <div class="max-w-xl mx-auto bg-white p-6 rounded-lg shadow">

    <h1 class="text-lg font-bold mb-4">Admin Panel</h1>

    <!-- LOGIN BOX -->
    <div id="loginBox" class="space-y-3">
      <input id="username" class="w-full p-2 border rounded" placeholder="Username">
      <input id="password" type="password" class="w-full p-2 border rounded" placeholder="Password">
      <button onclick="adminLogin()" class="w-full bg-indigo-600 text-white p-2 rounded">Login</button>
      <p id="loginError" class="text-red-600 text-sm"></p>
    </div>

    <!-- ADMIN CONTENT -->
    <div id="adminContent" class="hidden">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-bold">Master Data</h2>
        <button onclick="logout()" class="text-red-600 underline text-sm">Logout</button>
      </div>

      <div id="listsContainer"></div>
    </div>

  </div>

<script>
/* -----------------------------------
   FIREBASE CONFIG
----------------------------------- */
const firebaseConfig = {
  apiKey: "AIzaSyDGPkoewPcjffZ8ORwB3rrVAKiYtRYzuEk",
  authDomain: "retase-20ec2.firebaseapp.com",
  projectId: "retase-20ec2",
  storageBucket: "retase-20ec2.appspot.com",
  messagingSenderId: "414104675676",
  appId: "1:414104675676:web:95f0012dadfb1743ff8d99"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* -----------------------------------
   SIMPLE ADMIN LOGIN
----------------------------------- */

const ADMIN_USER = "admin";
const ADMIN_PASS = "mpadmin";

// FIRESTORE SECRET TOKEN (must match rules)
const ADMIN_TOKEN = "A9X2-FF39-MPA-2024-SECURE";

function adminLogin() {
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();

  if (u === ADMIN_USER && p === ADMIN_PASS) {
    sessionStorage.setItem("adminkey", ADMIN_TOKEN);
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("adminContent").classList.remove("hidden");
    loadLists();
  } else {
    document.getElementById("loginError").innerText = "Username atau password salah!";
  }
}

function logout() {
  sessionStorage.removeItem("adminkey");
  location.reload();
}

/* -----------------------------------
   LOAD LIST MASTER
----------------------------------- */
const LISTS_DOC = "settings/lists";

function loadLists() {
  db.doc(LISTS_DOC).onSnapshot(doc => {
    const data = doc.data() || {};
    renderLists(data);
  });
}

/* -----------------------------------
   RENDER LIST
----------------------------------- */
function renderLists(data) {
  const container = document.getElementById("listsContainer");

  const items = [
    { key: "supervisors", title: "Supervisor" },
    { key: "foremen", title: "Foreman" },
    { key: "checkers", title: "Checker" },
    { key: "masterUnits", title: "Unit" },
    { key: "masterDrivers", title: "Driver" }
  ];

  let html = "";

  items.forEach(it => {
    const arr = data[it.key] || [];
    html += `
      <div class="mb-6 p-3 border rounded bg-slate-50">
        <h3 class="font-bold mb-2">${it.title}</h3>

        <div class="flex flex-wrap gap-2 mb-2">
          ${arr.map((v,i)=>`
            <span class="px-2 py-1 bg-white border rounded flex items-center gap-2">
              ${v}
              <button onclick="removeItem('${it.key}', ${i})" class="text-red-600">Ã—</button>
            </span>
          `).join("")}
        </div>

        <div class="flex gap-2">
          <input id="inp-${it.key}" class="flex-1 p-2 border rounded" placeholder="Tambah ${it.title}">
          <button onclick="addItem('${it.key}')" class="px-3 bg-indigo-600 text-white rounded">Tambah</button>
        </div>
      </div>
    `;
  });

  container.innerHTML = html;
}

/* -----------------------------------
   ADD / REMOVE ITEM
----------------------------------- */
function addItem(key) {
  const inp = document.getElementById("inp-" + key);
  const value = inp.value.trim();
  if (!value) return;

  const token = sessionStorage.getItem("adminkey"); 
  if (!token) return alert("Tidak punya akses!");

  db.doc(LISTS_DOC).get().then(doc => {
    const data = doc.data() || {};
    const arr = data[key] || [];
    arr.push(value);

    db.doc(LISTS_DOC).set({ [key]: arr, _adminKey: token }, { merge: true });
    inp.value = "";
  });
}

function removeItem(key, index) {
  const token = sessionStorage.getItem("adminkey");
  if (!token) return alert("Tidak punya akses!");

  db.doc(LISTS_DOC).get().then(doc => {
    const data = doc.data() || {};
    const arr = data[key] || [];

    arr.splice(index, 1);

    db.doc(LISTS_DOC).set({ [key]: arr, _adminKey: token }, { merge: true });
  });
}

</script>

</body>
</html>